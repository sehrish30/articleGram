import React, {useEffect, Fragment, useContext} from 'react'
import {stringify} from 'query-string';

import Feed from 'components/feed';
import useFetch from 'hooks/useFetch';
import Pagination from 'components/pagination'
import {getPaginator, limit} from 'pages/utils';
import PopularTags from 'components/popularTags';
import Loading from 'components/loading';
import ErrorMessage from 'components/ErrorMessage';
import FeedToggler from 'components/feedToggler';
import Banner from 'components/banner';
import { CurrentUserContext } from '../../../contexts/currentUser';



const YourFeed = ({location, match}) => {

   
    // console.log('location', location, match)
    const {offset, currentPage}=getPaginator(location.search);

    const stringifiedParams =
    stringify({
        limit,
        offset
    })
    console.log('stringify', stringifiedParams);

    const apiUrl= `/articles/feed?${stringifiedParams}`;
    const currentUrl =match.url

    const [{response, error, isLoading}, doFetch]=useFetch(apiUrl);
    console.log('article res', response, error, isLoading)

    //Fetch the data
    useEffect(()=>{
      doFetch()
    },[currentPage, doFetch]) //current page when number changes page changes


    return (
        <div className='home-page'>
            <Banner />
            <div className='container page'>
                <div class="row">
                <div className="col-md-9">
                    <FeedToggler />
                    {isLoading && <Loading />}
                    {error && <ErrorMessage />}
                    {!isLoading && response && (
                        <Fragment>
                          <Feed articles={response.articles}/>
                          <Pagination total={response.articlesCount} limit={limit} url={currentUrl} currentPage={currentPage} />
                        </Fragment>
                    )}
                </div>
                <div className="col-md-3"><PopularTags /></div>
            </div>
            </div>
        </div>
    )
}

export default YourFeed
