import React, {useEffect, Fragment} from 'react'
import {stringify} from 'query-string';

import Feed from 'components/feed';
import useFetch from 'hooks/useFetch';
import Pagination from 'components/pagination'
import {getPaginator, limit} from 'pages/utils';

const GlobalFeed = ({location, match}) => {
    // console.log('location', location, match)
    const {offset, currentPage}=getPaginator(location.search);

    const stringifiedParams =
    stringify({
        limit,
        offset
    })
    console.log('stringify', stringifiedParams);

    const apiUrl= `/articles?${stringifiedParams}`;
    const currentUrl =match.url

    const [{response, error, isLoading}, doFetch]=useFetch(apiUrl);
    console.log('article res', response, error, isLoading)

    //Fetch the data
    useEffect(()=>{
      doFetch()
    },[currentPage, doFetch]) //current page when number changes page changes


    return (
        <div className='home-page'>
            <div className='banner'>
                <h1>Article Gram</h1>
                <p>Lets share knowledge!</p>
            </div>
            <div className='container page'>
                <div className="col-md-9">
                    {isLoading && <div>Loading...</div>}
                    {error && <div>Some error happened...</div>}
                    {!isLoading && response && (
                        <Fragment>
                          <Feed articles={response.articles}/>
                          <Pagination total={response.articlesCount} limit={limit} url={currentUrl} currentPage={currentPage} />
                        </Fragment>
                    )}
                </div>
                <div className="col-md-3">Popular tags</div>
            </div>
            
        </div>
    )
}

export default GlobalFeed
